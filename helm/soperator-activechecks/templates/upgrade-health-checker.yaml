apiVersion: slurm.nebius.ai/v1alpha1
kind: ActiveCheck
metadata:
  name: "upgrade-health-checker"
spec:
  checkType: "k8sJob"
  name: "upgrade-health-checker"
  dependsOn: [ "create-user-soperatorchecks" ]
  slurmClusterRefName: {{ .Values.slurmClusterRefName | quote }}
  # We should run this upgrade manually
  suspend: true
  runAfterCreation: false
  k8sJobSpec:
    jobContainer:
      command:
        - bash
        - -c
        - |
{{ tpl (.Files.Get "scripts/upgrade-health-checker.sh") . | indent 10 }}
      image: {{ .Values.images.k8sJob | quote }}
      volumeMounts:
{{ toYaml .Values.jobContainer.volumeMounts | indent 8 }}
      volumes:
{{ toYaml .Values.jobContainer.volumes | indent 8 }}
