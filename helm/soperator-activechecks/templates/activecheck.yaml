{{ if .Values.activeCheck.enabled }}
{{- if .Values.activeCheck.enabled }}
apiVersion: slurm.nebius.ai/v1alpha1
kind: ActiveCheck
metadata:
  name: {{ .Values.activeCheck.name | quote }}
spec:
  checkType: {{ .Values.activeCheck.checkType | quote }}
  name: {{ .Values.activeCheck.name | quote }}
  slurmClusterRefName: "$slurm_cluster_name"
  schedule: {{ .Values.activeCheck.schedule | quote }}
  suspend: {{ .Values.activeCheck.suspend }}
  successfulJobsHistoryLimit: {{ .Values.activeCheck.successfulJobsHistoryLimit }}
  failedJobsHistoryLimit: {{ .Values.activeCheck.failedJobsHistoryLimit }}
  runAfterCreation: {{ .Values.activeCheck.runAfterCreation }}
  {{- if eq .Values.activeCheck.checkType "k8sJob" }}
  k8sJobSpec:
    image: {{ .Values.images.k8sJob | quote }}
    command: {{ toYaml .Values.activeCheck.k8sJobSpec.command | nindent 6 }}
  {{- else if eq .Values.activeCheck.checkType "slurmJob" }}
  slurmJobSpec:
    sbatchScript: |
{{ .Values.activeCheck.slurmJobSpec.sbatchScript | indent 6 }}
    jobContainer:
      image: {{ .Values.images.slurmJob | quote }}
      env:
{{ toYaml .Values.activeCheck.slurmJobSpec.jobContainer.env | indent 8 }}
      volumeMounts:
{{ toYaml .Values.activeCheck.slurmJobSpec.jobContainer.volumeMounts | indent 8 }}
      volumes:
{{ toYaml .Values.activeCheck.slurmJobSpec.jobContainer.volumes | indent 8 }}
    mungeContainer:
      image: {{ .Values.images.munge | quote }}
  {{- end }}
{{- end }}
{{ end }}
