name: Nightly Multi-Arch Build

on:
  schedule:
    - cron: '0 0 * * *'  # Midnight UTC daily
  workflow_dispatch:  # Allow manual trigger

permissions:
  contents: read
  actions: write

jobs:
  trigger-builds:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Trigger nightly build on main
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        shell: bash
        run: |
          echo "Triggering nightly multi-arch build on main"
          gh workflow run one_job.yml --ref main -f multi_arch=true
          echo "Build triggered on main"

      - name: Trigger nightly build on release branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        shell: bash
        run: |
          RELEASE_BRANCH=$(jq -r .release_branch .github/branch-config.json)
          echo "Triggering nightly multi-arch build on ${RELEASE_BRANCH}"
          gh workflow run one_job.yml --ref "${RELEASE_BRANCH}" -f multi_arch=true
          echo "Build triggered on ${RELEASE_BRANCH}"
